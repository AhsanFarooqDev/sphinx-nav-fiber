import{c as fe,j as t,s as x,a as w,F as y,T as Z,r as l,u as F,N as K,y as he,d as xe,L as me,z as re,A as ge}from"./index-0b244911.js";import{Universe as ye}from"./index-9125f830.js";import{T as we,b as R,v as W,C as be,c as je,d as _e,e as Ce,f as ve,g as Se,h as Te,i as Ee,j as ze,a as Me}from"./index-a63c267b.js";import{u as G,H as ke,C as Pe}from"./index-8da311aa.js";import{S as Ie}from"./three.module-723b330f.js";import{R as $e,M as Re}from"./index-0b072e82.js";import"./TextareaAutosize-47d73af2.js";import"./index-e7db2b41.js";import"./ClipLoader-c5a0c991.js";import"./Skeleton-013e376c.js";import"./Stack-42df65a0.js";import"./isPlainObject-83d333cc.js";import"./Typography-cbb1ef8d.js";import"./createSvgIcon-e4204a21.js";import"./index-1a6af729.js";const He={selectedEpisodeId:"",selectedEpisodeLink:"",selectedEpisode:null},H=fe(e=>({...He,setSelectedEpisodeId:r=>e({selectedEpisodeId:r}),setSelectedEpisodeLink:r=>e({selectedEpisodeLink:r}),setSelectedEpisode:r=>e({selectedEpisode:r})})),Be=e=>t.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 30 28",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M7.2998 2.55199C7.2998 1.51094 8.11675 0.666992 9.1245 0.666992H12.1299C13.1376 0.666992 13.9546 1.51094 13.9546 2.55199C13.9546 3.59305 13.1376 4.43699 12.1299 4.43699H9.1245C8.11675 4.43699 7.2998 3.59305 7.2998 2.55199Z",fill:"currentColor"}),t.jsx("path",{d:"M7.2998 25.449C7.2998 26.49 8.11675 27.334 9.1245 27.334H12.1299C13.1376 27.334 13.9546 26.49 13.9546 25.449C13.9546 24.4079 13.1376 23.564 12.1299 23.564H9.1245C8.11675 23.564 7.2998 24.4079 7.2998 25.449Z",fill:"currentColor"}),t.jsx("path",{d:"M2.79102 8.29613C2.79102 7.25508 3.60796 6.41113 4.61571 6.41113H12.1292C13.1369 6.41113 13.9539 7.25508 13.9539 8.29613C13.9539 9.33719 13.1369 10.1811 12.1292 10.1811H4.61571C3.60796 10.1811 2.79102 9.33719 2.79102 8.29613Z",fill:"currentColor"}),t.jsx("path",{d:"M2.79102 19.7039C2.79102 20.7449 3.60796 21.5889 4.61571 21.5889H12.1292C13.1369 21.5889 13.9539 20.7449 13.9539 19.7039C13.9539 18.6628 13.1369 17.8189 12.1292 17.8189H4.61571C3.60796 17.8189 2.79102 18.6628 2.79102 19.7039Z",fill:"currentColor"}),t.jsx("path",{d:"M0 14.094C0 13.0529 0.816945 12.209 1.8247 12.209H12.1289C13.1366 12.209 13.9536 13.0529 13.9536 14.094C13.9536 15.135 13.1366 15.979 12.1289 15.979H1.8247C0.816946 15.979 0 15.135 0 14.094Z",fill:"currentColor"}),t.jsx("path",{d:"M22.7002 25.448C22.7002 26.4891 21.8833 27.333 20.8755 27.333H17.8701C16.8624 27.333 16.0454 26.4891 16.0454 25.448C16.0454 24.407 16.8624 23.563 17.8701 23.563H20.8755C21.8832 23.563 22.7002 24.407 22.7002 25.448Z",fill:"currentColor"}),t.jsx("path",{d:"M22.7002 2.55199C22.7002 1.51094 21.8833 0.666992 20.8755 0.666992H17.8701C16.8624 0.666992 16.0454 1.51094 16.0454 2.55199C16.0454 3.59305 16.8624 4.43699 17.8701 4.43699H20.8755C21.8832 4.43699 22.7002 3.59305 22.7002 2.55199Z",fill:"currentColor"}),t.jsx("path",{d:"M27.209 19.7029C27.209 20.7439 26.392 21.5879 25.3843 21.5879H17.8708C16.8631 21.5879 16.0461 20.7439 16.0461 19.7029C16.0461 18.6618 16.8631 17.8179 17.8708 17.8179H25.3843C26.392 17.8179 27.209 18.6618 27.209 19.7029Z",fill:"currentColor"}),t.jsx("path",{d:"M27.209 8.29613C27.209 7.25508 26.392 6.41113 25.3843 6.41113H17.8708C16.8631 6.41113 16.0461 7.25508 16.0461 8.29613C16.0461 9.33719 16.8631 10.1811 17.8708 10.1811H25.3843C26.392 10.1811 27.209 9.33719 27.209 8.29613Z",fill:"currentColor"}),t.jsx("path",{d:"M30 14.093C30 13.052 29.1831 12.208 28.1753 12.208H17.8711C16.8634 12.208 16.0464 13.052 16.0464 14.093C16.0464 15.1341 16.8634 15.978 17.8711 15.978H28.1753C29.1831 15.978 30 15.1341 30 14.093Z",fill:"currentColor"})]}),Ne=()=>t.jsxs(Le,{children:[t.jsx(De,{children:t.jsx(We,{children:t.jsx(Be,{})})}),t.jsx(Ae,{children:"Graph Mindset"})]}),Le=x(y).attrs({align:"center",direction:"row",grow:1,justify:"flex-start"})`
  height: 64px;
  padding: 20px 23px;
  gap: 0px;
  z-index: 50;
  position: relative;
`,De=x(y)`
  align-items: center;
  justify-content: center;
  cursor: pointer;
`,We=x.div`
  display: flex;
  align-items: center;
  justify-content: center;

  svg {
    width: 30px;
    height: 27px;
    color: ${w.white};
  }
`,Ae=x(Z)`
  width: 127px;
  height: 24px;
  color: ${w.white};
  font-family: Barlow;
  font-size: 22px;
  font-style: normal;
  font-weight: 700;
  line-height: 24px;
  letter-spacing: 0.22px;
  margin-left: 16px;
  white-space: nowrap;
`,Ze=e=>t.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 7 12",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M4.77978 6.00243L0.706705 1.92933C0.568239 1.79088 0.497405 1.61684 0.494205 1.40723C0.490989 1.19763 0.561822 1.02039 0.706705 0.875528C0.851572 0.730645 1.02721 0.658203 1.23361 0.658203C1.44001 0.658203 1.61564 0.730645 1.7605 0.875528L6.25473 5.36975C6.34833 5.46334 6.41436 5.56205 6.45281 5.6659C6.49127 5.76974 6.51051 5.88191 6.51051 6.00243C6.51051 6.12294 6.49127 6.23512 6.45281 6.33895C6.41436 6.4428 6.34833 6.54152 6.25473 6.6351L1.7605 11.1293C1.62205 11.2678 1.44802 11.3386 1.2384 11.3418C1.0288 11.345 0.851572 11.2742 0.706705 11.1293C0.561822 10.9845 0.48938 10.8088 0.48938 10.6024C0.48938 10.396 0.561822 10.2204 0.706705 10.0755L4.77978 6.00243Z",fill:"currentColor"})}),Fe=/^(https?:\/\/)/,Ge=/(www\.)?/,Ue=/[\w-]+(\.[\w-]+)*/,qe=/(?:\.[a-zA-Z0-9][a-zA-Z0-9-]{0,61})[a-zA-Z0-9](?:\.[a-zA-Z]{2,})/,Ye=/(\/[^\s?]*)?/,Xe=/(\?[^\s]*)?/,Oe=/(https?:\/\/)?(www\.)?youtube\.com\/watch\?v=([A-Za-z0-9_-]+)/,Ve=/(https?:\/\/)?(www\.)?youtube\.com\/live\/([A-Za-z0-9_-]+)/,Ke=/(https?:\/\/)?(www\.)?youtu\.be\/([A-Za-z0-9_-]+)/,Je=/(https?:\/\/)?([A-Za-z0-9_-]+)\.mp3/,Qe=new RegExp(`${Fe.source}${Ge.source}${Ue.source}${qe.source}?${Ye.source}${Xe.source}$`,"i"),et=e=>{try{if(!(e==null?void 0:e.match(Qe)))return!1;const o=new URL(e).hostname;return o!=null&&o.startsWith("www.")?((o==null?void 0:o.match(/\./g))||[]).length>=2:((o==null?void 0:o.match(/\./g))||[]).length>=1}catch{return!1}},J=e=>et(e)?[Oe,Ve,Ke,Je].some(n=>n.test(e)):!1,tt=async e=>{const r="add_node",n={};n.media_url=e.source,n.content_type="audio_video";const o=await he.post(`/${r}`,JSON.stringify(n));if(o.error){const{message:a}=o.error;throw new Error(a)}return o},rt=()=>{const[e,r]=l.useState(""),[n,o]=l.useState(!1),[a,i]=l.useState(""),{setRunningProjectId:s}=F(p=>p),{setSelectedEpisodeId:d,setSelectedEpisodeLink:c}=H(p=>p),f=p=>{const{value:j}=p.target;r(j),o(j!==""&&!J(j))},u=async()=>{if(J(e))try{const p=await tt({source:e});p.data.project_id&&s(p.data.project_id),p.data.ref_id&&(d(p.data.ref_id),c(e))}catch(p){let j=K;if((p==null?void 0:p.status)===400){const _=await p.json();j=_.errorCode||(_==null?void 0:_.status)||K,_.data.ref_id&&(d(_.data.ref_id),c(e))}else p instanceof Error&&(j=p.message);i(String(j))}};return t.jsxs(ot,{children:[t.jsx(st,{children:"Ideas have shapes"}),t.jsxs(it,{children:[t.jsx(nt,{error:n,onChange:f,onKeyDown:p=>p.key==="Enter"&&u(),placeholder:"Paste podcast or video link",value:e}),t.jsx(at,{error:n,onClick:n?void 0:u,children:t.jsx(Ze,{})})]}),a&&t.jsx("div",{children:a})]})},ot=x(y)`
  background: #16161de3;
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  top: 0;
  color: #fff;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-style: normal;
  font-weight: 700;
  line-height: 16px;
  font-family: 'Barlow';
  z-index: 40;
`,st=x(y)`
  color: ${w.white};
  font-family: Barlow;
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 40px;
  text-shadow: 0px 2px 4px rgba(0, 0, 0, 0.25);
`,nt=x.input`
  width: 100%;
  max-width: 450px;
  padding: 12px 28px 12px 16px;
  border-radius: 100px;
  border: 1px solid ${e=>e.error?"red":w.DIVIDER_4};
  background: ${w.INPUT_BG};
  color: ${w.white};
  font-family: Barlow;
  font-size: 16px;

  &::placeholder {
    color: ${w.INPUT_PLACEHOLDER};
  }

  &:focus {
    outline: none;
    border-color: ${e=>e.error?"red":w.primaryBlue};
  }
`,it=x.div`
  position: relative;
  width: 450px;
  display: flex;
  align-items: center;
`,at=x.div`
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  color: ${w.white};
  font-size: 20px;
  cursor: ${e=>e.error?"not-allowed":"pointer"};

  svg {
    width: 8px;
    height: 17px;
    color: ${w.GRAY6};
  }
`,P=[{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"1",node_type:"Clip",name:"Podcast"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"2",node_type:"Topic",name:"Bitcoin"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"3",node_type:"Topic",name:"Blockchain"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"4",node_type:"Topic",name:"Hard Money"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"5",node_type:"Topic",name:"Digital Currency"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"6",node_type:"Topic",name:"Government Control"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"7",node_type:"Topic",name:"Inflation"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"8",node_type:"Topic",name:"Public Network"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"9",node_type:"Topic",name:"Energy Consumption"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"10",node_type:"Topic",name:"Immutability"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"11",node_type:"Topic",name:"Scarcity"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"12",node_type:"Topic",name:"Decentralization"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"13",node_type:"Topic",name:"Investment Risks"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"14",node_type:"Topic",name:"Adoption"},{edge_count:0,x:0,y:0,z:0,label:"label",ref_id:"15",node_type:"Person",name:"Satoshi Nakamoto"}],U=[{ref_id:"1",edge_type:"Mentioned",target:"1",source:"2",start:7.68,end:19.619},{ref_id:"2",edge_type:"Mentioned",target:"1",source:"4",start:28.019,end:38.04},{ref_id:"3",edge_type:"Mentioned",target:"1",source:"3",start:50.82,end:56.52},{ref_id:"4",edge_type:"Mentioned",target:"1",source:"5",start:19.439,end:25.619},{ref_id:"5",edge_type:"Mentioned",target:"1",source:"6",start:34.619,end:43.02},{ref_id:"6",edge_type:"Mentioned",target:"1",source:"9",start:31.8,end:38.04},{ref_id:"7",edge_type:"Mentioned",target:"1",source:"10",start:56.52,end:60.48},{ref_id:"8",edge_type:"Mentioned",target:"1",source:"12",start:90.72,end:97.52},{ref_id:"9",edge_type:"Mentioned",target:"1",source:"13",start:126.44,end:133.48},{ref_id:"10",edge_type:"Mentioned",target:"1",source:"14",start:122.44,end:130.48}],A=U.filter(e=>e==null?void 0:e.start).map(e=>({source:e.source,start:e==null?void 0:e.start}));(P||[]).filter(e=>A.some(r=>r.source===e.ref_id)).map(e=>{const r=A.find(n=>e.ref_id===n.source);return{...e,start:(r==null?void 0:r.start)||0}}).filter(e=>e);const oe=U.flatMap(e=>{const{start:r,end:n}=e.properties??{};return r!==void 0&&n!==void 0?[r,n]:[0,0]}),Q=Math.min(...oe),ee=Math.max(...oe),te=(e,r,n,o,a)=>o+(e-r)/(n-r)*(a-o),ct=({type:e})=>{var s,d;const[r]=xe(c=>[c.normalizedSchemasByType]),n=(s=r[e])==null?void 0:s.primary_color,o=(d=r[e])==null?void 0:d.icon,i={iconStart:(o?`svg-icons/${o}.svg`:null)??"thing_badge.svg",color:n??w.THING};return t.jsx(lt,{...i,label:e})},lt=({iconStart:e,color:r,label:n})=>t.jsx(dt,{color:r,children:t.jsx("img",{alt:n,className:"badge__img",src:e})}),dt=x(y).attrs({direction:"row"})`
  cursor: pointer;
  background: ${({color:e})=>e};
  border-radius: 3px;
  overflow: hidden;
  justify-content: center;
  align-items: center;
  padding: 0 4px;

  .badge__img {
    width: 10px;
    height: 10px;
    object-fit: contain;
  }
`,pt=({duration:e,progress:r,markers:n})=>t.jsxs(ft,{children:[t.jsx(ut,{value:r,variant:"determinate"}),n.map(o=>{var s;const a=((o==null?void 0:o.start)||0)/e*100,i=(o==null?void 0:o.node_type)||"";return t.jsx(ht,{style:{left:`${a}%`},children:t.jsx(we,{content:`${((s=o==null?void 0:o.properties)==null?void 0:s.name)||i}`,children:t.jsx(ct,{type:i})})},o==null?void 0:o.ref_id)})]}),ut=x(me)`
  && {
    height: 2px;
    background-color: ${w.white};
    color: blue;
    flex-grow: 1;

    .MuiLinearProgress-bar {
      background: ${w.GRAY6};
    }
  }
`,ft=x(y)`
  position: relative;
  flex: 1 1 100%;
`,ht=x.div`
  position: absolute;
  top: -4px; /* Adjust as needed to center above the progress bar */
  width: 8px;
  height: 8px;
  background-color: ${w.white};
  border-radius: 50%;
  transform: translateX(-50%); /* Center the marker horizontally */
  transform: translateX(-50%) translateY(-50%);
  top: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
`,xt=({markers:e})=>{var u;const{isPlaying:r,setIsPlaying:n,playingTime:o,playingNode:a,duration:i}=R(p=>p),[s,d]=(u=a==null?void 0:a.properties)!=null&&u.timestamp?a.properties.timestamp.split("-").map(p=>W(p)):[0,i],c=(o-s)/(d-s)*100;return a?t.jsxs(mt,{children:[t.jsxs(gt,{children:[t.jsx(be,{}),t.jsx(yt,{"data-testid":"play-pause-button",onClick:p=>{n(!r),p.stopPropagation()},size:"small",children:r?t.jsx(je,{"data-testid":"pause-icon"}):t.jsx(_e,{"data-testid":"play-icon"})}),t.jsx(Ce,{})]}),t.jsx(pt,{duration:i,markers:e,progress:c}),!1]}):null},mt=x(y).attrs({direction:"row",align:"center",justify:"space-between"})`
  padding: 20px;
  background: ${w.BG2};
  height: 96px;
  margin-top: 16px;
  border-radius: 8px;
  box-sizing: border-box;
`,gt=x(y).attrs({direction:"row",align:"center",justify:"flex-start"})`
  width: 142px;
  height: 54px;
  background: ${w.BG1};
  border-radius: 40px;
  margin-right: 54px;
  color: ${w.white};
  font-size: 20px;
  padding: 12px;
  justify-content: space-between;
  box-sizing: border-box;
`,yt=x(ve)`
  && {
    font-size: 36px;
    padding: 2px;
    overflow: hidden;
  }
`,wt=(e,r,n)=>{const o=new Ie;return o.moveTo(-e/2+n,-r/2),o.lineTo(e/2-n,-r/2),o.quadraticCurveTo(e/2,-r/2,e/2,-r/2+n),o.lineTo(e/2,r/2-n),o.quadraticCurveTo(e/2,r/2,e/2-n,r/2),o.lineTo(-e/2+n,r/2),o.quadraticCurveTo(-e/2,r/2,-e/2,r/2-n),o.lineTo(-e/2,-r/2+n),o.quadraticCurveTo(-e/2,-r/2,-e/2+n,-r/2),o},bt=({width:e,height:r,radius:n,color:o})=>{console.log(e,r);const a=wt(e,r,n);return t.jsxs("mesh",{children:[t.jsx("shapeGeometry",{args:[a]}),t.jsx("meshBasicMaterial",{color:o,opacity:.9,transparent:!0})]})},jt=({name:e,url:r})=>t.jsxs(_t,{children:[r&&t.jsx("img",{alt:"",className:"image",src:r}),t.jsx("div",{className:"title",children:e}),t.jsx("div",{className:"action-btn",children:t.jsx(Se,{})})]}),_t=x(y)`
  position: relative;
  padding: 14px;
  padding-right: 28px;
  flex: 1;
  width: 100%;
  box-sizing: border-box;

  .title {
    margin-top: 8px;
  }

  .image {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    margin-bottom: 8px;
    object-fit: cover;
  }

  .action-btn {
    top: 14px;
    right: 14px;
    color: ${w.GRAY6};
    position: absolute;
  }
`,Ct=({width:e,height:r,position:n,url:o,onButtonClick:a,name:i,type:s,color:d})=>{const{camera:c,size:f}=G();console.info(o,s);const u=(_,M)=>{const h=c,b=h.right-h.left,m=h.top-h.bottom;return{pixelWidth:_/b*f.width,pixelHeight:M/m*f.height}},{pixelWidth:p,pixelHeight:j}=u(e,r);return t.jsxs("group",{position:n,children:[t.jsx(bt,{color:d,height:r,radius:1.5,width:e}),t.jsx(ke,{position:[-e/2,r/2,0],children:t.jsx(y,{onClick:()=>a(),style:{fontSize:"20px",color:"white",fontWeight:600,width:`${p}px`,height:`${j}px`,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"8px",pointerEvents:"auto"},children:t.jsx(jt,{name:i,url:"logo.png"})})})]})},vt=185,St=()=>{const e=G(),{width:r}=e.viewport,{camera:n}=e;l.useEffect(()=>{const s=n,d=c=>{c.preventDefault(),c.ctrlKey?(s.zoom+=c.deltaY*-.01,s.zoom=Math.max(.5,Math.min(s.zoom,5))):s.position.x+=c.deltaX*.01,s.updateProjectionMatrix()};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[n]);const o=0,a=97.52*10,i=l.useMemo(()=>U.filter(s=>{var d,c;return((d=s==null?void 0:s.properties)==null?void 0:d.start)&&((c=s==null?void 0:s.properties)==null?void 0:c.end)}).map(s=>{var f,u;const d=((f=s==null?void 0:s.properties)==null?void 0:f.start)||0,c=((u=s==null?void 0:s.properties)==null?void 0:u.end)||0;return{source:s.source,target:s.target,xStart:te(d,Q,ee,o,a),xEnd:te(c,Q,ee,o,a)}}),[o,a]);return t.jsxs(t.Fragment,{children:[P.map((s,d)=>{var f;return i.some(u=>u.source===P[d].ref_id)?(f=i.find(u=>u.source===P[d].ref_id))!=null&&f.xStart:d*35,null}),A.map(s=>{const d=P.find(u=>u.ref_id===s.source),c=s.start/vt*r,f=-5;return d?t.jsx(Ct,{color:"red",height:10,name:d.name,onButtonClick:()=>null,position:[c,f,0],type:d.node_type,url:"logo.png",width:5},d.ref_id):null}),t.jsxs("mesh",{position:[-13,0,0],children:[t.jsx("circleGeometry",{args:[3,64]})," ",t.jsx("meshBasicMaterial",{color:"blue"})]})]})},Tt=()=>{const[e,r]=l.useState(0),n=o=>{r(Number(o.target.value))};return t.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[t.jsx("div",{style:{position:"absolute",top:10,left:10,zIndex:10},children:t.jsx("input",{max:100,min:-100,onChange:n,step:1,type:"range",value:e})}),t.jsxs(Pe,{orthographic:!0,children:[t.jsx(Et,{x:e}),t.jsx(St,{}),t.jsx("gridHelper",{args:[100,100,"white","gray"]}),t.jsx("gridHelper",{args:[100,100,"white","gray"],rotation:[Math.PI/2,0,0]}),t.jsx("axesHelper",{args:[5]})]})]})},Et=({x:e})=>{const{size:r,viewport:n,camera:o}=G(),a=50,i=r.width/r.height;console.log(i,r.width);const s=-a*i/2,d=a*i/2,c=a/2,f=-a/2;return l.useEffect(()=>{const u=o;u.left=s,u.right=d,u.top=c,u.bottom=f,u.position.x=e,u.updateProjectionMatrix()},[o,s,d,c,f,e]),l.useEffect(()=>{console.log("Viewport Width in World Units:",n.width)},[n.width]),null},zt=(e,r)=>{let n=0,o=e.length-1;for(;n<=o;){const a=Math.floor((n+o)/2),i=e[a],{start:s,end:d}=i.properties;if(r>=s&&r<=d)return i;r<s?o=a-1:n=a+1}return null},Mt=({mediaUrl:e})=>{const r=l.useRef(null),n=l.useRef(null),[o,a]=l.useState(!1),[i,s]=l.useState(!1),[d,c]=l.useState(!1),[f,u]=l.useState("ready"),[p,j]=l.useState(!1),[_,M]=l.useState(""),[h,b]=l.useState(!1),m=Te(),{setActiveEdge:C}=Ee(g=>g),{dataInitial:E}=F(g=>g);l.useEffect(()=>{const g="00:00:00-00:12:00",v=g==null?void 0:g.split("-")[0];M(v)},[m]);const{isPlaying:q,playingTime:Y,setIsPlaying:B,setPlayingTime:z,setDuration:N,playingNode:k,volume:se,setHasError:ne,resetPlayer:X,isSeeking:L,setIsSeeking:O}=R(g=>g);l.useEffect(()=>()=>X(),[X]),l.useEffect(()=>{k&&!p&&(z(0),N(0),j(!1),b(!1))},[k,z,N,j,p]),l.useEffect(()=>{L&&r.current&&(r.current.seekTo(Y,"seconds"),O(!1))},[Y,L,O]),l.useEffect(()=>{if(p&&_&&r.current&&!h){const g=W(_);r.current.seekTo(g,"seconds"),z(g),b(!0)}},[p,_,z,h]);const V=()=>{B(!q)},ie=()=>{B(!0)},ae=()=>{B(!1)},ce=()=>{ne(!0),u("error")},le=l.useMemo(()=>((E==null?void 0:E.links.filter(S=>{var T;return(T=S==null?void 0:S.properties)==null?void 0:T.start}))||[]).slice().sort((S,T)=>{var $,D;return(($=S==null?void 0:S.properties)==null?void 0:$.start)-((D=T==null?void 0:T.properties)==null?void 0:D.start)}),[E]),de=g=>{if(!L){const v=g.playedSeconds;z(v);const S=zt(le,v);S&&C(S)}},pe=()=>{if(r.current){u("ready");const g=r.current.getDuration();if(N(g),_&&!h){const v=W(_);r.current.seekTo(v,"seconds"),z(v),b(!0)}}},I=()=>{s(!!document.fullscreenElement),document.removeEventListener("fullscreenchange",I)};l.useEffect(()=>()=>{document.removeEventListener("fullscreenchange",I)}),l.useEffect(()=>{const g=v=>{if(i){const S=window.screen.height,T=v.clientY,$=S-T;c($<=50)}};return document.addEventListener("mousemove",g),()=>{document.removeEventListener("mousemove",g)}},[i,d]),l.useEffect(()=>{const g=v=>{i&&v.key==="Escape"?(v.preventDefault(),v.stopPropagation()):o&&v.key===" "&&(v.preventDefault(),V())};return document.addEventListener("fullscreenchange",I),document.addEventListener("keydown",g),()=>{document.removeEventListener("fullscreenchange",I),document.removeEventListener("keydown",g)}});const ue=()=>{V()};return e?t.jsxs(kt,{ref:n,onBlur:()=>a(!1),onFocus:()=>a(!0),tabIndex:0,children:[t.jsx(Pt,{isFullScreen:i,children:t.jsx(ze,{size:120,src:(k==null?void 0:k.image_url)||"",type:"clip"})}),t.jsx($t,{isFullScreen:i,onClick:ue,children:t.jsx($e,{ref:r,controls:!0,height:i?window.screen.height:"219px",onBuffer:()=>u("buffering"),onBufferEnd:()=>u("ready"),onError:ce,onPause:ae,onPlay:ie,onProgress:de,onReady:pe,playing:q,url:e||"",volume:se,width:"100%"})}),f==="error"?t.jsx(It,{className:"error-wrapper",children:"Error happened, please try later"}):null]}):null},kt=x(y)`
  border-bottom: 1px solid rgba(0, 0, 0, 0.25);
  background: rgba(0, 0, 0, 0.2);
  position: relative;
  overflow: hidden;
  height: auto;
  &:focus {
    outline: none;
  }
`,Pt=x(y)`
  position: absolute;
  top: ${e=>e.isFullScreen?"38%":"18%"};
  left: 50%;
  transform: translateX(-50%);
  z-index: -1;
`,It=x(y)`
  height: 60px;
  padding: 12px 16px;
  color: ${w.primaryRed};
`,$t=x.div`
  margin: ${e=>e.isFullScreen?"80px auto":"0"};
  width: 100%;
  cursor: pointer;
`,Rt=l.memo(Mt),Ht=()=>{const{selectedEpisodeId:e}=H(i=>i),{playingTime:r,duration:n}=R(i=>i),[o,a]=l.useState([]);return l.useEffect(()=>{e&&(async()=>{try{const s=await re(e,0,50,{nodeType:["Clip"],useSubGraph:!1});s!=null&&s.nodes&&a(s.nodes)}catch(s){console.error(s)}})()},[e]),t.jsxs(Bt,{children:[t.jsx(y,{className:"heading",children:"Transcript"}),o.map(i=>{var f,u,p;const s=(f=i==null?void 0:i.properties)==null?void 0:f.timestamp,[d,c]=s?s.split("-").map(Number):[0,n];return d<=r*1e3&&r*1e3<c?t.jsx(Nt,{direction:"row",children:((u=i==null?void 0:i.properties)==null?void 0:u.text)&&t.jsx("span",{children:(p=i==null?void 0:i.properties)==null?void 0:p.text})},i.ref_id):null})]})},Bt=x(y)`
  .heading {
    font-weight: 700;
    font-size: 12px;
    margin-bottom: 16px;
  }

  color: ${w.white};
  background: ${w.BG1};
  border-radius: 8px;
  padding: 24px;
  overflow-y: auto;
  flex: 1 1 100%;
`,Nt=x(y)`
  flex-wrap: wrap;
  flex: 1 1 100%;
`,Lt=()=>{var n,o;const{selectedEpisodeLink:e,selectedEpisode:r}=H(a=>a);return t.jsxs(Dt,{align:"stretch",basis:"100%",grow:1,shrink:1,children:[t.jsxs(Zt,{children:[(r==null?void 0:r.name)&&t.jsx(At,{children:r==null?void 0:r.name}),((n=r==null?void 0:r.properties)==null?void 0:n.text)&&t.jsx(Wt,{children:(o=r==null?void 0:r.properties)==null?void 0:o.text}),e&&t.jsx(Rt,{mediaUrl:e})]}),t.jsx(Ht,{})]})},Dt=x(y)(({theme:e})=>({position:"relative",display:"flex",padding:"20px",background:"transparent",width:"100%",[e.breakpoints.up("sm")]:{width:Re}})),Wt=x(Z)`
  font-size: 20px;
  font-weight: Bold;
  line-height: 24.2px;
  overflow-wrap: break-word;
  white-space: normal;
  word-break: break-word;
  margin-right: 10px;
  font-weight: 500;
`,At=x(Z)`
  margin-top: 20px;
  font-size: 14px;
  font-weight: 700;
  line-height: 16.94px;
`,Zt=x(y)(({theme:e})=>({width:"100%",margin:"16px auto",zIndex:29,[e.breakpoints.up("sm")]:{width:"390px"}})),sr=()=>{const{addNewNode:e,isFetching:r,runningProjectId:n,dataInitial:o}=F(h=>h),[a,i]=l.useState(!1),{selectedEpisodeId:s,setSelectedEpisode:d}=H(h=>h),c=Me(),f=l.useRef(null),u=l.useRef(null),{setPlayingNode:p}=R(h=>h),j=l.useCallback(h=>{r||(f.current||(f.current={nodes:[],edges:[]}),h.edges&&f.current.edges.push(...h.edges),h.nodes&&f.current.nodes.push(...h.nodes),u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{if(f.current){const{nodes:b,edges:m}=f.current,C={nodes:b,edges:m};f.current={nodes:[],edges:[]},e(C)}},3e3))},[e,r]),_=l.useCallback(h=>{console.log(h,"uuuuuupdate")},[]);l.useEffect(()=>{s&&(async()=>{try{const b=await re(s,0,50);b&&j(b)}catch(b){console.error(b)}})()},[s,j]),l.useEffect(()=>{s&&(async()=>{try{const b=await ge(s);b&&(p(b),d(b))}catch(b){console.error(b)}})()},[s,p,d]),l.useEffect(()=>(c&&(c.on("new_node_created",j),c.on("node_updated",_)),()=>{c&&c.off()}),[c,_,j]),l.useEffect(()=>{if(n)try{c==null||c.emit("update_project_id",{id:n})}catch(h){console.error(h)}},[n,c]);const M=l.useMemo(()=>{if(o){const h=o.links.filter(m=>{var C;return(C=m==null?void 0:m.properties)==null?void 0:C.start}).map(m=>{var C;return{source:m.source,target:m.target,start:(C=m.properties)==null?void 0:C.start}});return o.nodes.filter(m=>o.links.some(C=>C.source===m.ref_id||C.target===m.ref_id)).map(m=>{const C=h.find(E=>m.ref_id===E.source||m.ref_id===E.target);return{...m,start:(C==null?void 0:C.start)||0}}).filter(m=>m&&m.node_type!=="Clip"&&m.node_type!=="Episode"&&m.node_type!=="Show")}return[]},[o]);return t.jsx(y,{direction:"row",style:{height:"100%"},children:s?t.jsxs(t.Fragment,{children:[t.jsxs(y,{children:[t.jsx(y,{onClick:()=>i(!a),children:t.jsx(Ne,{})}),t.jsx(Lt,{})]}),t.jsxs(y,{basis:"100%",grow:1,p:16,shrink:1,children:[t.jsx(y,{basis:"100%",grow:1,shrink:1,children:a?t.jsx(Tt,{}):t.jsx(ye,{})}),t.jsx(xt,{markers:M})]})]}):t.jsx(rt,{})})};export{sr as MindSet};
