import{ad as M,bX as k,bY as g,bZ as V,s as B,T as C,F as d,al as $,r as x,b as E,j as n,aW as z,aX as K,B as S,e as _,t as U,v as R,aU as A,aZ as G}from"./index-1d805415.js";import{l as I}from"./index-3ac851f3.js";import{A as N}from"./index-f3df532f.js";import"./index-5b7bb80c.js";import"./Stack-2f0ef3f5.js";import"./createSvgIcon-b68c7390.js";import"./TextareaAutosize-3b102137.js";const D="https://community.sphinx.chat",O=async e=>await M.post("/bounty",JSON.stringify(e)),W=async e=>await k(`${D}/person/${e}`,{headers:{"Content-Type":"application/json"},method:"GET"}),P=async e=>await k(`${D}/workspaces/user/${e}`,{headers:{"Content-Type":"application/json"},method:"GET"});async function q(){try{const e=Math.floor(Date.now()/1e3),t=g.Buffer.from(e.toString(16),"hex"),s=g.Buffer.from(t).toString("base64"),o=await V.signMessage(s),a=v(o.signature),l=g.Buffer.concat([t,a],a.length+t.length);return L(l)}catch(e){return console.log("error from signing more message: ",e),""}}function v(e){const t=e.replace(/_/g,"/").replace(/-/g,"+"),s=t.padEnd(t.length+(4-t.length%4)%4,"=");return g.Buffer.from(s,"base64")}function L(e){let t="";const s=e.byteLength;for(let a=0;a<s;a+=1)t+=String.fromCharCode(e[a]);return btoa(t).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,"")}const F=/^[0-9]+$/,X=e=>{const t=e.trim();return!!(t&&F.test(t))},Z=({errMessage:e,handleClose:t})=>{const{setValue:s,watch:o}=$(),[a,l]=x.useState([]),{pubKey:p}=E();x.useEffect(()=>{async function r(){try{const c=await W(p);if(!c.id){l([{label:"SecondBrain",value:"SecondBrain"}]);return}const u=await P(c.id);if(u.length>0){const w=[];for(let b=0;b<u.length;b+=1){const j=u[b];w.push({label:j.name,value:j.uuid})}l(w)}}catch(c){console.error("Error from get user details: ",c)}}r()},[p]);const i=o("budget",""),m=o("nodeType",""),f=r=>{const c=(r==null?void 0:r.label)||"SecondBrain",u=(r==null?void 0:r.value)||"ck9drb84nncjnaefo090";s("nodeType",c,{shouldValidate:!0}),s("workspaceUuid",u)},y=X(i)&&!!m,h=r=>{r.key===" "&&r.preventDefault()};return n.jsxs(d,{children:[n.jsx(d,{align:"center",direction:"row",justify:"space-between",mb:18,children:n.jsx(H,{children:"Create Bounty"})}),n.jsxs(d,{mb:20,children:[n.jsx(T,{children:"Select Workspace"}),n.jsx(N,{autoFocus:!0,onSelect:f,options:a})]}),n.jsxs(d,{mb:20,children:[n.jsx(T,{children:"Set Budget"}),n.jsx(z,{id:"budget",name:"budget",onKeyDown:h,placeholder:"Enter budget",rules:{...K,pattern:{value:F,message:"Please enter a valid number"}},value:i})]}),n.jsxs(d,{direction:"row",children:[n.jsx(d,{grow:1,children:n.jsx(S,{color:"secondary",onClick:()=>t(),size:"large",variant:"contained",children:"Cancel"})}),n.jsx(d,{grow:1,ml:20,children:n.jsx(S,{color:"secondary",disabled:!y,size:"large",type:"submit",variant:"contained",children:"Confirm"})})]}),e&&n.jsx(J,{children:e})]})},T=B(C)`
  font-size: 14px;
  font-weight: 600;
  font-family: 'Barlow';
  margin-bottom: 6px;
`,H=B(C)`
  font-size: 18px;
  font-weight: 600;
  font-family: 'Barlow';
  margin-bottom: 6px;
`,J=B(d)`
  font-size: 13px;
  font-family: Barlow;
  color: #ff8f80;
  line-height: 0.2px;
  margin-top: 12px;
  padding-top: 20px;
`,Y=()=>{const[e,t]=x.useState(""),{close:s}=_("createBounty"),o=I(),{pubKey:a}=E(),l=U({mode:"onChange"}),{handleSubmit:p,setValue:i}=l,m=()=>{i("budget",""),i("nodeType",""),i("workspaceUuid",""),s()},f=async y=>{const{budget:h,workspaceUuid:r}=y;try{const c=await q(),u={type:"code_generation",amount:Number(h),workspace_uuid:r||"ck9drb84nncjnaefo090",ref_id:o==null?void 0:o.ref_id,node_data:(o==null?void 0:o.properties)||{},jwt_token:c,pub_key:a};await O(u),A("Bounty Created")}catch(c){t(c)}finally{i("budget",""),i("nodeType",""),i("workspaceUuid",""),m()}};return n.jsx(R,{...l,children:n.jsx("form",{id:"create-bounty-form",onSubmit:p(f),children:n.jsx(Z,{errMessage:e,handleClose:m})})})},ae=()=>{const{close:e}=_("createBounty"),t=U({mode:"onChange"}),{setValue:s}=t,o=()=>{s("budget",""),s("nodeType",""),e()},a="small";return n.jsx(G,{id:"createBounty",kind:a,onClose:o,preventOutsideClose:!0,children:n.jsx(Y,{})})};export{ae as CreateBountyModal};
